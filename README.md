# **Fully Automated Personal Cloud with Nextcloud on GCP**

## **1\. Project Overview**

* **Goal:** To build a secure, cost-effective personal cloud for file storage using Nextcloud. The entire environment is hosted on Google Cloud Platform (GCP) and is designed to be fully automated, from network creation to software installation.  
* **Core Principle:** Security and automation are paramount. All resources are deployed within a private Virtual Private Cloud (VPC), accessible only via a secure VPN. Infrastructure is managed by Terraform, and software configuration is handled automatically by Ansible.

## **2\. Core Architecture & Technologies**

This project leverages a modern, fully automated toolchain:

* **Cloud Provider:** Google Cloud Platform (GCP)  
* **Infrastructure as Code (IaC):** Terraform, used to programmatically define and deploy all cloud resources (VPC, VMs, Firewall Rules, etc.).  
* **Configuration Management:** Ansible, used to automatically install and configure software (Pritunl, Docker) on the virtual machines after they are created by Terraform.  
* **VPN Gateway:** Pritunl, providing secure OpenVPN access.  
* **Containerization:** Docker, running the official Nextcloud All-in-One (AIO) image.

## **3\. Deployment Guide**

### **Prerequisites**

* A Google Cloud Platform account with billing enabled.  
* The gcloud CLI installed and authenticated on a local machine.  
* Terraform installed on a local machine.  
* Ansible installed on a local machine.

### **The Automated Deployment Workflow**

This project is designed to be deployed with a single command. The process is as follows:

1. **Configuration:** The user runs a setup script (setup.sh) to provide essential variables like their GCP Project ID and home IP address for secure SSH access.  
2. **Infrastructure Provisioning (terraform apply):**  
   * Terraform creates the entire cloud network (VPC, Subnet, Cloud NAT, Firewall Rules).  
   * Terraform provisions two virtual machines: pritunl-vpn-server and nextcloud-aio-server.  
3. **Dynamic Inventory Generation:** Terraform automatically creates an Ansible inventory file, telling Ansible the IP addresses of the new VMs.  
4. **Configuration Management (Ansible Playbooks):**  
   * Immediately after creating the pritunl-vpn-server, Terraform triggers an **Ansible playbook**. This playbook connects to the VM and automatically installs and configures the Pritunl software.  
   * Simultaneously, Terraform triggers a second **Ansible playbook** on the nextcloud-aio-server that installs Docker.  
5. **Manual Finalization:** The only manual steps are the one-time configuration of the Pritunl web interface and the Nextcloud AIO interface after the automated deployment is complete.

## **4\. Repository Structure**

* **main.tf:** The core Terraform file defining all GCP resources.  
* **variables.tf:** Defines all configurable variables for the Terraform deployment.  
* **ansible/ directory:**  
  * inventory.ini: A dynamic inventory file generated by Terraform.  
  * playbook-pritunl.yml: The Ansible playbook for setting up the Pritunl server.  
  * playbook-nextcloud.yml: The Ansible playbook for setting up the Nextcloud server (installing Docker).  
* **setup.sh:** The user-friendly script to configure deployment variables.

## **5\. Conclusion & Key Learnings**

This project successfully demonstrates a fully automated, secure, and cost-conscious private cloud deployment. Key skills showcased include:

* **Holistic Automation:** Integrating Terraform (for infrastructure) and Ansible (for configuration) to create a seamless, one-command deployment process.  
* **Cloud Security:** Implementing a zero-trust network model where access is denied by default and only explicitly allowed through a secure VPN gateway.  
* **Advanced IaC:** Using Terraform to not only create resources but also to trigger subsequent configuration management tasks.